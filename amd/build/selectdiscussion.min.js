define("mod_forumng/selectdiscussion",["exports","mod_forumng/common"],(function(_exports,_common){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.SelectDiscussion=void 0;_exports.SelectDiscussion=
/**
   * JavaScript to handle select discussion.
   *
   * @module mod_forumng/selectdiscussion
   * @copyright 2024 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
class{constructor(options){this.cloneID=options.cloneID,this.stringList=options.stringList,this.select=options.select}selectDiscussInit(target,includes,excludes){this.select.on=!!target;const discussions=document.querySelectorAll(".forumng-discussionlist tr");if(0==discussions.length)return;const confirm=document.createElement("input");confirm.setAttribute("type","submit");const main=document.querySelector("table.forumng-discussionlist"),all=document.createElement("input"),none=document.createElement("input");if(this.select.on){const form=document.createElement("form");form.setAttribute("method","post"),this.select.form=form,form.setAttribute("action",target.form.getAttribute("action")),main.classList.add("forumng-selectmode"),form.inputs=document.createElement("div"),form.appendChild(form.inputs);let field=document.createElement("input");field.setAttribute("type","hidden"),field.setAttribute("name","fromselect"),field.setAttribute("value","1"),form.inputs.appendChild(field),this.cloneID&&(field=document.createElement("input"),field.setAttribute("type","hidden"),field.setAttribute("name","clone"),field.setAttribute("value",this.cloneID),form.inputs.appendChild(field)),target.form.children[0].querySelectorAll("input").forEach((node=>{if("hidden"==node.getAttribute("type")){const field=node.cloneNode(!0);form.inputs.appendChild(field)}})),form.intro=document.createElement("div"),form.intro.classList.add("forumng-selectintro"),main.parentNode.insertBefore(form.intro,main);const introText=document.createElement("p");introText.textContent=this.stringList.selectdiscintro,form.intro.appendChild(introText);const selectButtons=document.createElement("div");selectButtons.classList.add("forumng-selectbuttons"),form.intro.appendChild(selectButtons),all.setAttribute("type","button"),all.setAttribute("value",this.stringList.selectall),selectButtons.appendChild(all),all.addEventListener("click",(()=>{for(let i=1;i<discussions.length;i++)discussions[i].check&&!discussions[i].check.checked&&(0,_common.simulateClick)(discussions[i].check);all.disabled=!0,none.disabled=!1})),selectButtons.appendChild(document.createTextNode(" ")),none.setAttribute("type","button"),none.setAttribute("value",this.stringList.deselectall),selectButtons.appendChild(none),none.addEventListener("click",(()=>{for(let i=1;i<discussions.length;i++)discussions[i].check&&discussions[i].check.checked&&(0,_common.simulateClick)(discussions[i].check);all.disabled=!1,none.disabled=!0}));const forumngFeatures=document.querySelector("#forumng-features");forumngFeatures&&main.closest(".forumng-main").contains(forumngFeatures)?main.closest(".forumng-main").insertBefore(form,forumngFeatures):main.parentNode.appendChild(form),form.outro=document.createElement("div"),form.outro.classList.add("forumng-selectoutro"),form.appendChild(form.outro),confirm.setAttribute("value",this.stringList.confirmselection),form.outro.appendChild(confirm),form.outro.appendChild(document.createTextNode(" "));const cancel=document.createElement("input");cancel.setAttribute("type","button"),cancel.setAttribute("id","forumng-cancel-select"),cancel.setAttribute("value",this.stringList.cancel),form.outro.appendChild(cancel),cancel.addEventListener("click",(()=>{this.selectDiscussInit(null)})),(0,_common.scrollPage)(form.intro,null),document.querySelectorAll(".forumng-dselectorbutton input").forEach((node=>{node.disabled=!0}))}else{const form=this.select.form;form.remove(),form.intro.remove(),form.outro.remove(),main.classList.remove("forumng-selectmode"),this.select.form=null,document.querySelectorAll(".forumng-dselectorbutton input").forEach((node=>{node.disabled=!1}))}discussions.forEach(((discussion,index)=>{if(index>0&&discussion.classList.contains("forumng-discussion-short")){let useid=discussion.id;useid=useid.replace("discrow_","");let include=!0;if(this.select.on){if(includes.length>0){include=!1;for(let a=0;a<includes.length;a++)if(discussion.classList.contains(includes[a])){include=!0;break}}if(excludes.length>0)for(let a=0;a<excludes.length;a++)if(discussion.classList.contains(excludes[a])){include=!1;break}}include&&this.selectInitDiscuss(discussion,this.select.on,useid)}})),window.forumng_select_changed=()=>{let ok=!1,checkcount=0,availcount=0;discussions.forEach((discussion=>{discussion.check&&(availcount++,discussion.check.checked&&(ok=!0,checkcount++))})),none.disabled=!ok,confirm.disabled=!ok,all.disabled=checkcount==availcount},this.select.on&&window.forumng_select_changed()}selectInitDiscuss(discussion,on,number){if(on){const info=discussion.querySelector("td.cell.c0"),span=document.createElement("span");span.classList.add("dselectorcheck");const spanSeparator=document.createElement("span");info.prepend(span),discussion.extraSpan=span,discussion.classList.add("forumng-deselected");const discussionId=number;spanSeparator.classList.add("forumng-separator"),spanSeparator.appendChild(document.createTextNode(" â€¢ "));const check=document.createElement("input");check.setAttribute("type","checkbox"),check.setAttribute("id","check"+discussionId),discussion.check=check,span.appendChild(check);const label=document.createElement("label");label.classList.add("accesshide"),label.setAttribute("for",check.getAttribute("id")),span.appendChild(label),label.appendChild(document.createTextNode(this.stringList.selectlabel.replace("{$a}",number))),span.appendChild(spanSeparator),(0,_common.linksDisable)(document.body);let hidden=document.querySelector("input[name='select"+discussionId+"']");hidden||(hidden=document.createElement("input"),hidden.setAttribute("type","hidden"),hidden.setAttribute("value","0"),hidden.setAttribute("name","selectd"+discussionId),this.select.form.appendChild(hidden)),discussion.forumng_hidden=hidden,check.addEventListener("click",(()=>{check.checked?(discussion.classList.remove("forumng-deselected"),discussion.forumng_hidden.setAttribute("value","1")):(discussion.classList.add("forumng-deselected"),discussion.forumng_hidden.setAttribute("value","0")),window.forumng_select_changed()}))}else discussion.extraSpan&&discussion.extraSpan.remove(),discussion.classList.remove("forumng-deselected"),(0,_common.linksEnable)(document.body)}}}));

//# sourceMappingURL=selectdiscussion.min.js.map