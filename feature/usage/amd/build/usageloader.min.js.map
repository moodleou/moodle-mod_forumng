{"version":3,"file":"usageloader.min.js","sources":["../src/usageloader.js"],"sourcesContent":["/**\n * Javascript module loading in forumng data.\n *\n * @module      forumngfeature_usage/usageloader\n * @copyright   2024 Will Wise\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\n\n/**\n * Initializes the usage loader, pulls in content.\n *\n * @param {string} name - The name of the usage type.\n * @param {Object} params - The parameters for the usage request.\n */\nexport const init = (name, params) => {\n    const container = document.querySelector('.forumngusageshow' + name);\n    if (!container) {\n        return;\n    }\n    let div = document.createElement('div');\n    div.classList.add('ajaxworking');\n    container.append(div);\n    Ajax.call([{\n        methodname: 'forumngfeature_usage_get_usage',\n        args: {\n            type: name,\n            param: params\n        },\n        done: function(o) {\n            if (o.responseText) {\n                // Process the JSON data returned from the server.\n                try {\n                    let response = JSON.parse(o.responseText);\n                    if (response.error) {\n                        usageloader_killspinner(true, container);\n                        return;\n                    }\n                    if (response.content) {\n                        usageloader_killspinner(false, container);\n                        container.innerHTML = response.content;\n                    }\n                } catch (e) {\n                    usageloader_killspinner(true, container);\n                }\n            } else {\n                usageloader_killspinner(true, container);\n            }\n        },\n        fail: function () {\n            usageloader_killspinner(true, container);\n        }\n    }]);\n};\n\n/**\n * Removes the spinner and optionally shows the noajax load link.\n *\n * @param {boolean} failed - Indicates if the request failed.\n * @param {HTMLElement} container - The container element.\n */\nconst usageloader_killspinner = (failed, container) => {\n    const spinner = container.querySelector('.ajaxworking');\n    if (spinner) {\n        spinner.remove();\n    }\n    if (failed) {\n        // Show noajax load link.\n        const noscript = container.querySelector('.forumngusage_loader_noscript');\n        if (noscript) {\n            noscript.style.display = 'block';\n        }\n    }\n};\n"],"names":["name","params","container","document","querySelector","div","createElement","classList","add","append","call","methodname","args","type","param","done","o","responseText","response","JSON","parse","error","usageloader_killspinner","content","innerHTML","e","fail","failed","spinner","remove","noscript","style","display"],"mappings":";;;;;;;oJAgBoB,CAACA,KAAMC,gBACjBC,UAAYC,SAASC,cAAc,oBAAsBJ,UAC1DE,qBAGDG,IAAMF,SAASG,cAAc,OACjCD,IAAIE,UAAUC,IAAI,eAClBN,UAAUO,OAAOJ,mBACZK,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CACFC,KAAMb,KACNc,MAAOb,QAEXc,KAAM,SAASC,MACPA,EAAEC,qBAGMC,SAAWC,KAAKC,MAAMJ,EAAEC,iBACxBC,SAASG,kBACTC,yBAAwB,EAAMpB,WAG9BgB,SAASK,UACTD,yBAAwB,EAAOpB,WAC/BA,UAAUsB,UAAYN,SAASK,SAErC,MAAOE,GACLH,yBAAwB,EAAMpB,gBAGlCoB,yBAAwB,EAAMpB,YAGtCwB,KAAM,WACFJ,yBAAwB,EAAMpB,sBAWpCoB,wBAA0B,CAACK,OAAQzB,mBAC/B0B,QAAU1B,UAAUE,cAAc,mBACpCwB,SACAA,QAAQC,SAERF,OAAQ,OAEFG,SAAW5B,UAAUE,cAAc,iCACrC0B,WACAA,SAASC,MAAMC,QAAU"}