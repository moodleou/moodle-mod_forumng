{"version":3,"file":"usageloader.min.js","sources":["../src/usageloader.js"],"sourcesContent":["/**\n * Javascript module loading in forumng data.\n *\n * @module      forumngfeature_usage/usageloader\n * @copyright   2024 Will Wise\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\n\n/**\n * Initializes the usage loader, pulls in content.\n *\n * @param {string} name - The name of the usage type.\n * @param {Object} params - The parameters for the usage request.\n */\nexport const init = (name, params) => {\n    const container = document.querySelector('.forumngusageshow' + name);\n    if (!container) {\n        return;\n    }\n    let div = document.createElement('div');\n    div.classList.add('ajaxworking');\n    container.append(div);\n    Ajax.call([{\n        methodname: 'mod_forumng_get_usage',\n        args: {\n            type: name,\n            param: params\n        },\n        done: function(o) {\n            if (o.responseText) {\n                // Process the JSON data returned from the server.\n                try {\n                    let response = JSON.parse(o.responseText);\n                    if (response.error) {\n                        usageloader_killspinner(true, container);\n                        return;\n                    }\n                    if (response.content) {\n                        usageloader_killspinner(false, container);\n                        container.innerHTML = response.content;\n                    }\n                } catch (e) {\n                    usageloader_killspinner(true, container);\n                }\n            } else {\n                usageloader_killspinner(true, container);\n            }\n        },\n        fail: function () {\n            usageloader_killspinner(true, container);\n        }\n    }]);\n};\n\n/**\n * Removes the spinner and optionally shows the noajax load link.\n *\n * @param {boolean} failed - Indicates if the request failed.\n * @param {HTMLElement} container - The container element.\n */\nconst usageloader_killspinner = (failed, container) => {\n    const spinner = container.querySelector('.ajaxworking');\n    if (spinner) {\n        spinner.remove();\n    }\n    if (failed) {\n        // Show noajax load link.\n        const noscript = container.querySelector('.forumngusage_loader_noscript');\n        if (noscript) {\n            noscript.style.display = 'block';\n        }\n    }\n};\n"],"names":["e","_ajax","__esModule","default","_exports","init","name","params","container","document","querySelector","div","createElement","classList","add","append","Ajax","call","methodname","args","type","param","done","o","responseText","response","JSON","parse","error","usageloader_killspinner","content","innerHTML","fail","failed","spinner","remove","noscript","style","display"],"mappings":"4FAQ6B,IAAAA;;;;;;;kFAA7BC,OAA6BD,EAA7BC,QAA6BD,EAAAE,WAAAF,EAAAG,CAAAA,QAAAH,GA8C3BI,SAAAC,KAtCkBA,CAACC,KAAMC,UACvB,MAAMC,UAAYC,SAASC,cAAc,oBAAsBJ,MAC/D,IAAKE,UACD,OAEJ,IAAIG,IAAMF,SAASG,cAAc,OACjCD,IAAIE,UAAUC,IAAI,eAClBN,UAAUO,OAAOJ,KACjBK,MAAIb,QAACc,KAAK,CAAC,CACPC,WAAY,wBACZC,KAAM,CACFC,KAAMd,KACNe,MAAOd,QAEXe,KAAM,SAASC,GACX,GAAIA,EAAEC,aAEF,IACI,IAAIC,SAAWC,KAAKC,MAAMJ,EAAEC,cAC5B,GAAIC,SAASG,MAET,YADAC,yBAAwB,EAAMrB,WAG9BiB,SAASK,UACTD,yBAAwB,EAAOrB,WAC/BA,UAAUuB,UAAYN,SAASK,QAEtC,CAAC,MAAO9B,GACL6B,yBAAwB,EAAMrB,UAClC,MAEAqB,yBAAwB,EAAMrB,UAErC,EACDwB,KAAM,WACFH,yBAAwB,EAAMrB,UAClC,IACD,EASP,MAAMqB,wBAA0BA,CAACI,OAAQzB,aACrC,MAAM0B,QAAU1B,UAAUE,cAAc,gBAIxC,GAHIwB,SACAA,QAAQC,SAERF,OAAQ,CAER,MAAMG,SAAW5B,UAAUE,cAAc,iCACrC0B,WACAA,SAASC,MAAMC,QAAU,QAEjC,EACF"}